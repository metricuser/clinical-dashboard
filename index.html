
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Clinical Metrics Dashboard</title>
  <style>
    table, th, td {
      border: 1px solid lightgray;
      border-collapse: collapse;
      padding: 8px;
    }
    th {
      background-color: #f2f2f2;
    }
    .red { color: red; }
    .orange { color: orange; }
    .green { color: green; }
  </style>
</head>
<body>
  <h2>Clinical Metrics Entry</h2>

  <label for="month">Month:</label>
  <select id="month">
    <option value="All">All</option>
  </select>

  <button onclick="exportCSV()">Export CSV</button>

  <br><br>
  <table id="metricsTable">
    <thead>
      <tr>
        <th>Facility</th>
        <th>Segment</th>
        <th>Month</th>
        <th>Year</th>
        <th>Census</th>
        <th>APW%</th>
        <th>SWL%</th>
        <th>Falls%</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const data = [
      { facility: "Allis", segment: "Midwest", month: "March", year: 2025, census: 88, apw: 9, swl: 4, falls: 7 },
      { facility: "Best Care", segment: "Southern Hospitality", month: "March", year: 2025, census: 77, apw: 1, swl: 5, falls: 13 },
      { facility: "Bradford", segment: "Northern Pride", month: "February", year: 2025, census: 76, apw: 4, swl: 13, falls: 12 },
    ];

    const monthDropdown = document.getElementById("month");
    const tableBody = document.querySelector("#metricsTable tbody");

    const thresholds = {
      apw: 3,
      swl: 5,
      falls: 13
    };

    function loadMonths() {
      const months = Array.from(new Set(data.map(d => d.month)));
      months.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m;
        opt.text = m;
        monthDropdown.add(opt);
      });
    }

    function colorize(value, type) {
      const threshold = thresholds[type];
      if (value >= threshold) return "red";
      if (value >= threshold * 0.75) return "orange";
      return "green";
    }

    function populateTable() {
      tableBody.innerHTML = "";
      const filterMonth = monthDropdown.value;
      data.filter(row => filterMonth === "All" || row.month === filterMonth)
        .forEach(row => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.facility}</td>
            <td>${row.segment}</td>
            <td>${row.month}</td>
            <td>${row.year}</td>
            <td>${row.census}</td>
            <td class="${colorize(row.apw, 'apw')}">${row.apw.toFixed(1)}%</td>
            <td class="${colorize(row.swl, 'swl')}">${row.swl.toFixed(1)}%</td>
            <td class="${colorize(row.falls, 'falls')}">${row.falls.toFixed(1)}%</td>
          `;
          tableBody.appendChild(tr);
        });
    }

    function exportCSV() {
      const rows = [["Facility", "Segment", "Month", "Year", "Census", "APW%", "SWL%", "Falls%"]];
      const filterMonth = monthDropdown.value;

      data.filter(row => filterMonth === "All" || row.month === filterMonth)
        .forEach(row => {
          rows.push([
            row.facility,
            row.segment,
            row.month,
            row.year,
            row.census,
            row.apw.toFixed(1) + "%",
            row.swl.toFixed(1) + "%",
            row.falls.toFixed(1) + "%"
          ]);
        });

      const csvContent = rows.map(e => e.join(",")).join("\n");
      const blob = new Blob([csvContent], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "clinical_metrics.csv";
      link.click();
    }

    monthDropdown.addEventListener("change", populateTable);

    loadMonths();
    populateTable();
  </script>
</body>
</html>
